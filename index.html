<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üçΩÔ∏è √âtterem Kalkul√°tor</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: Arial, sans-serif; background: #f0f4f8; color: #222; }

  /* HEADER */
  header { background: #1F3864; color: white; padding: 14px 32px; display: flex; align-items: center; justify-content: space-between; gap: 14px; flex-wrap: wrap; }
  header h1 { font-size: 20px; }
  .btn { padding: 8px 18px; border-radius: 8px; border: none; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.15s; }
  .btn-settings { background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.3); }
  .btn-settings:hover { background: rgba(255,255,255,0.25); }
  .btn-primary { background: #2E5DA6; color: white; }
  .btn-primary:hover { background: #1a3d7a; }
  .btn-danger { background: #c0392b; color: white; }
  .btn-danger:hover { background: #a93226; }
  .btn-success { background: #27ae60; color: white; }
  .btn-success:hover { background: #1e8449; }
  .btn-sm { padding: 5px 12px; font-size: 12px; }
  .btn-xs { padding: 3px 8px; font-size: 11px; }

  /* F≈ê F√úLEK (Pizza / Pasta) */
  .main-tabs { background: #162d54; display: flex; gap: 0; }
  .main-tab { padding: 12px 28px; font-size: 15px; font-weight: bold; color: rgba(255,255,255,0.6); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.15s; }
  .main-tab:hover { color: white; }
  .main-tab.active { color: white; border-bottom-color: #FFD700; }

  /* PROFIL S√ÅV */
  .profil-bar { background: #1a3666; padding: 7px 32px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .profil-label { color: rgba(255,255,255,0.5); font-size: 11px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
  .profil-btn { padding: 5px 14px; border-radius: 20px; border: 2px solid rgba(255,255,255,0.2); background: transparent; color: rgba(255,255,255,0.65); font-size: 12px; font-weight: bold; cursor: pointer; transition: all 0.15s; }
  .profil-btn:hover { border-color: rgba(255,255,255,0.5); color: white; }
  .profil-btn.active { background: white; color: #1F3864; border-color: white; }
  .profil-btn.uj { border-style: dashed; color: rgba(255,255,255,0.4); }
  .profil-btn.uj:hover { color: white; border-color: white; }

  .container { max-width: 1040px; margin: 24px auto; padding: 0 16px; }
  .card { background: white; border-radius: 10px; padding: 20px 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px; }
  .card h3 { color: #1F3864; font-size: 15px; margin-bottom: 14px; }
  .hidden { display: none !important; }

  /* M√ìD V√ÅLT√ì */
  .mode-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .mode-tab { flex: 1; min-width: 120px; padding: 10px 14px; border: 2px solid #dde3f0; border-radius: 10px; background: white; cursor: pointer; text-align: center; font-size: 13px; font-weight: bold; color: #888; transition: all 0.15s; }
  .mode-tab:hover { border-color: #2E5DA6; color: #2E5DA6; }
  .mode-tab.active { border-color: #1F3864; background: #1F3864; color: white; }
  .mode-tab .sub { font-size: 10px; font-weight: normal; opacity: 0.8; display: block; margin-top: 2px; }

  /* INPUT */
  .input-panels { display: flex; gap: 14px; flex-wrap: wrap; }
  .input-panel { flex: 1; min-width: 200px; border-radius: 10px; padding: 16px 18px; border: 2px solid #dde3f0; }
  .input-panel.p45 { border-color: #2E5DA6; background: #f0f4ff; }
  .input-panel.p32 { border-color: #E8A000; background: #fff8e1; }
  .input-panel.ppasta { border-color: #8E44AD; background: #f9f0ff; }
  .input-panel.pgnocchi { border-color: #27ae60; background: #f0fff4; }
  .input-panel h4 { font-size: 13px; margin-bottom: 10px; }
  .p45 h4 { color: #1F3864; } .p32 h4 { color: #7A4F00; }
  .ppasta h4 { color: #6C1A9B; } .pgnocchi h4 { color: #1a5c32; }
  .dual-input { display: flex; flex-direction: column; gap: 8px; }
  .iblock { border: 2px solid #dde3f0; border-radius: 8px; padding: 10px 14px; background: white; }
  .iblock.a45 { border-color: #2E5DA6; background: #e8f0fe; }
  .iblock.a32 { border-color: #E8A000; background: #fff3cd; }
  .iblock.apasta { border-color: #8E44AD; background: #f3e5ff; }
  .iblock.agnocchi { border-color: #27ae60; background: #e8f8f0; }
  .iblock label { font-size: 10px; font-weight: bold; color: #888; text-transform: uppercase; letter-spacing: 0.4px; display: block; margin-bottom: 4px; }
  .irow { display: flex; align-items: center; gap: 6px; }
  .iblock input[type=number] { font-size: 20px; font-weight: bold; color: #1F3864; border: none; outline: none; background: transparent; width: 100%; }
  .iblock .sfx { font-size: 12px; color: #888; white-space: nowrap; }
  .or-div { text-align: center; font-size: 11px; color: #aaa; font-weight: bold; }

  /* SUMMARY */
  .summary-bar { background: #1F3864; color: white; border-radius: 10px; padding: 14px 20px; margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap; align-items: center; }
  .si .sl { font-size: 10px; opacity: 0.7; margin-bottom: 2px; }
  .si .sv { font-size: 17px; font-weight: bold; }
  .si.hl .sv { color: #FFD700; }
  .ssep { width: 1px; background: rgba(255,255,255,0.2); align-self: stretch; min-height: 32px; }

  /* SLIDER */
  .slider-wrap { display: flex; gap: 16px; flex-wrap: wrap; }
  .slider-box { flex: 1; min-width: 200px; border-radius: 10px; padding: 14px 18px; }
  .slider-box.s45 { background: #f0f4ff; border: 2px solid #2E5DA6; }
  .slider-box.s32 { background: #fff8e1; border: 2px solid #E8A000; }
  .slider-box .stitle { font-size: 12px; font-weight: bold; margin-bottom: 10px; }
  .s45 .stitle { color: #2E5DA6; } .s32 .stitle { color: #7A4F00; }
  .slider-side { display: flex; flex-direction: column; gap: 6px; }
  .slider-side label { font-size: 13px; font-weight: bold; color: #555; }
  input[type=range] { width: 200px; accent-color: #2E5DA6; cursor: pointer; }
  .gv-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
  .gv { border-radius: 8px; padding: 7px 12px; text-align: center; min-width: 80px; border: 2px solid #2E5DA6; background: #f0f4ff; }
  .gv.tk { border-color: #E8A000; background: #fff8e1; }
  .gv .gl { font-size: 9px; color: #888; margin-bottom: 1px; }
  .gv .gn { font-size: 17px; font-weight: bold; color: #1F3864; }
  .gv.tk .gn { color: #7A4F00; }
  .gv .gp { font-size: 10px; color: #2E5DA6; font-weight: bold; }
  .gv.tk .gp { color: #E8A000; }
  .vs { font-size: 13px; color: #ccc; font-weight: bold; }
  .reset-btn { background: #f0f4f8; border: 1px solid #ccc; border-radius: 6px; padding: 5px 12px; font-size: 11px; cursor: pointer; color: #555; margin-top: 6px; display: inline-block; }
  .reset-btn:hover { background: #dde5f0; }

  /* PASTA T√âSZTA AR√ÅNY */
  .teszta-box { background: #f9f0ff; border: 2px solid #8E44AD; border-radius: 10px; padding: 14px 18px; margin-bottom: 20px; }
  .teszta-box h4 { color: #6C1A9B; font-size: 13px; margin-bottom: 12px; }
  .teszta-sliders { display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start; }
  .teszta-slider { display: flex; flex-direction: column; gap: 4px; min-width: 160px; }
  .teszta-slider label { font-size: 12px; font-weight: bold; color: #555; }
  .teszta-cards { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px; }
  .teszta-card { background: white; border: 2px solid #8E44AD; border-radius: 8px; padding: 8px 14px; text-align: center; min-width: 80px; }
  .teszta-card .tn { font-size: 11px; color: #888; }
  .teszta-card .tv { font-size: 18px; font-weight: bold; color: #6C1A9B; }
  .teszta-card .tp { font-size: 11px; color: #8E44AD; font-weight: bold; }

  /* SECTION */
  .section { background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px; overflow: hidden; }
  .section-title { background: #2E5DA6; color: white; padding: 10px 18px; font-weight: bold; font-size: 14px; }
  .section-title.pasta-color { background: #8E44AD; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; }
  th { background: #2E5DA6; color: white; padding: 8px 12px; text-align: center; font-size: 11px; }
  th.pasta-th { background: #8E44AD; }
  th:first-child { text-align: left; }
  td { padding: 7px 12px; border-bottom: 1px solid #eee; }
  td:first-child { font-weight: 500; }
  td:not(:first-child) { text-align: center; }
  tr:hover { background: #e8f0fe; }
  .val { font-weight: bold; color: #1F3864; }
  .ceil { font-weight: bold; color: #375623; background: #E2EFDA; border-radius: 5px; padding: 2px 7px; display: inline-block; }
  .unit { color: #888; font-size: 10px; margin-left: 2px; }
  .dash { color: #bbb; }
  .gh td { font-weight: bold; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; padding: 7px 12px 5px; border-bottom: none; color: white; }
  .gh-gomboc td { background: #1F3864; }
  .gh-alap td { background: #2E5DA6; }
  .gh-pasta td { background: #8E44AD; }
  .gh-gnocchi td { background: #27ae60; }
  .gh-hus td { background: #7B3F00; }
  .gh-sajt td { background: #5C6BC0; }
  .gh-gomba td { background: #2E7D32; }
  .gh-egyeb td { background: #546E7A; }
  .row-gomboc { background: #fff8e1 !important; }
  .row-gomboc td:first-child { color: #7A4F00; font-weight: bold; }
  .row-pasta { background: #f9f0ff !important; }
  .row-gnocchi { background: #f0fff4 !important; }
  .row-norm:nth-child(even) { background: #f7f9fc; }

  /* √âTEL GRID */
  .etel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(185px, 1fr)); gap: 8px; padding: 14px; }
  .etel-card { background: #f7f9fc; border: 1px solid #dde3f0; border-radius: 8px; padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; }
  .etel-card.pasta-card { border-color: #c9a0e8; background: #faf0ff; }
  .etel-card.gnocchi-card { border-color: #90d4a8; background: #f0fff6; }
  .etel-nev { font-size: 12px; font-weight: 500; }
  .etel-db { font-size: 14px; font-weight: bold; color: #2E5DA6; }
  .etel-db.pasta-db { color: #8E44AD; }
  .etel-db.gnocchi-db { color: #27ae60; }
  .etel-pct { font-size: 10px; color: #888; }

  /* MODAL */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: flex-start; justify-content: center; padding: 20px; overflow-y: auto; }
  .modal-overlay.hidden { display: none; }
  .modal { background: white; border-radius: 14px; width: 100%; max-width: 760px; overflow: hidden; box-shadow: 0 8px 40px rgba(0,0,0,0.2); }
  .modal-header { background: #1F3864; color: white; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
  .modal-header h2 { font-size: 17px; }
  .modal-close { background: none; border: none; color: white; font-size: 22px; cursor: pointer; opacity: 0.7; }
  .modal-close:hover { opacity: 1; }
  .modal-tabs { display: flex; border-bottom: 2px solid #eee; overflow-x: auto; }
  .modal-tab { padding: 11px 16px; text-align: center; font-size: 12px; font-weight: bold; color: #888; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.15s; white-space: nowrap; }
  .modal-tab.active { color: #1F3864; border-bottom-color: #1F3864; }
  .modal-body { padding: 20px 24px; max-height: 70vh; overflow-y: auto; }
  .modal-footer { padding: 14px 24px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap; }

  /* BE√ÅLL√çT√ÅSOK */
  .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .si-item { display: flex; flex-direction: column; gap: 6px; }
  .si-item label { font-size: 12px; font-weight: bold; color: #555; }
  .si-item input { border: 2px solid #dde3f0; border-radius: 8px; padding: 10px 14px; font-size: 15px; font-weight: bold; color: #1F3864; outline: none; width: 100%; }
  .si-item input:focus { border-color: #2E5DA6; }
  .si-item .hint { font-size: 11px; color: #888; }

  /* √âTEL BE√ÅLL√çT√ÅSOK */
  .etel-settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
  .arany-ossz { font-size: 13px; font-weight: bold; }
  .arany-ossz.ok { color: #27ae60; } .arany-ossz.err { color: #c0392b; }
  .etel-row { display: flex; align-items: center; gap: 10px; padding: 9px 0; border-bottom: 1px solid #f0f0f0; }
  .toggle-wrap { position: relative; width: 38px; height: 22px; flex-shrink: 0; }
  .toggle-wrap input { opacity: 0; width: 0; height: 0; }
  .tog-sl { position: absolute; inset: 0; background: #ccc; border-radius: 22px; cursor: pointer; transition: 0.2s; }
  .tog-sl:before { content: ''; position: absolute; width: 16px; height: 16px; left: 3px; top: 3px; background: white; border-radius: 50%; transition: 0.2s; }
  .toggle-wrap input:checked + .tog-sl { background: #27ae60; }
  .toggle-wrap input:checked + .tog-sl:before { transform: translateX(16px); }
  .etel-nev-lbl { flex: 1; font-size: 13px; font-weight: 500; }
  .etel-nev-lbl.off { color: #bbb; text-decoration: line-through; }
  .arany-iw { display: flex; align-items: center; gap: 4px; }
  .arany-inp { width: 68px; border: 2px solid #dde3f0; border-radius: 6px; padding: 5px 8px; font-size: 13px; font-weight: bold; color: #1F3864; text-align: right; outline: none; }
  .arany-inp:focus { border-color: #2E5DA6; }
  .arany-inp:disabled { background: #f5f5f5; color: #ccc; border-color: #eee; }
  .norm-btn { background: #2E5DA6; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 11px; cursor: pointer; }
  .norm-btn:hover { background: #1F3864; }

  /* PROFIL TAB */
  .profil-lista { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
  .profil-sor { display: flex; align-items: center; gap: 10px; background: #f7f9fc; border-radius: 8px; padding: 10px 14px; border: 2px solid #eee; }
  .profil-sor.aktiv { border-color: #2E5DA6; background: #f0f4ff; }
  .profil-nev-inp { flex: 1; border: 1.5px solid transparent; border-radius: 6px; padding: 6px 10px; font-size: 14px; font-weight: bold; outline: none; background: transparent; }
  .profil-nev-inp:focus { border-color: #2E5DA6; background: white; }
  .profil-aktiv-badge { font-size: 10px; background: #2E5DA6; color: white; border-radius: 10px; padding: 2px 8px; white-space: nowrap; }
  .profil-default-badge { font-size: 10px; background: #888; color: white; border-radius: 10px; padding: 2px 8px; white-space: nowrap; }
  .uj-profil-form { background: #f0fff4; border: 2px dashed #27ae60; border-radius: 10px; padding: 16px; }
  .uj-profil-form h4 { color: #1a5c32; font-size: 14px; margin-bottom: 12px; }
  .form-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
  .form-field { display: flex; flex-direction: column; gap: 4px; flex: 1; min-width: 140px; }
  .form-field label { font-size: 11px; font-weight: bold; color: #555; }
  .form-field input, .form-field select { border: 2px solid #dde3f0; border-radius: 7px; padding: 8px 12px; font-size: 13px; outline: none; width: 100%; }
  .form-field input:focus, .form-field select:focus { border-color: #27ae60; }

  footer { text-align: center; color: #aaa; font-size: 11px; padding: 20px; }
</style>
</head>
<body>

<header>
  <div>
    <h1>üçΩÔ∏è √âtterem Kalkul√°tor</h1>
    <div style="font-size:12px;opacity:0.7;">Pizza ¬∑ Pasta ¬∑ Alapanyag tervez≈ë</div>
  </div>
  <button class="btn btn-settings" onclick="openSettings()">‚öôÔ∏è Be√°ll√≠t√°sok</button>
</header>

<!-- F≈ê F√úLEK -->
<div class="main-tabs">
  <div class="main-tab active" id="maintab-pizza" onclick="setMainTab('pizza')">üçï Pizza</div>
  <div class="main-tab" id="maintab-pasta" onclick="setMainTab('pasta')">üçù Pasta</div>
</div>

<!-- PROFIL S√ÅV -->
<div class="profil-bar" id="profil-bar"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PIZZA SZEKCI√ì ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="section-pizza">
<div class="container">

  <div class="mode-tabs">
    <div class="mode-tab active" id="tab-45" onclick="setMod('45')">üçï 45cm-es<span class="sub">Szeletenk√©nt</span></div>
    <div class="mode-tab" id="tab-32" onclick="setMod('32')">ü´ì 32cm-es<span class="sub">Eg√©sz pizza</span></div>
    <div class="mode-tab" id="tab-kombi" onclick="setMod('kombi')">üîÄ Kombin√°lt<span class="sub">Mindk√©t m√©ret</span></div>
  </div>

  <div class="card">
    <h3 id="pizza-input-title">üìä Mennyi √°ru kell?</h3>
    <div class="input-panels" id="pizza-input-panels"></div>
  </div>

  <div class="summary-bar" id="pizza-summary"></div>

  <div class="card">
    <h3>ü´ì Gomb√≥c ar√°ny (sima / TK)</h3>
    <div class="slider-wrap">
      <div class="slider-box s45">
        <div class="stitle">üçï 45cm-es</div>
        <div class="slider-side">
          <label>Sima: <strong id="s45-sima">70%</strong> &nbsp; TK: <strong id="s45-tk">30%</strong></label>
          <input type="range" id="sl45" min="0" max="100" value="70" oninput="sl45Change(this.value)">
          <button class="reset-btn" onclick="sl45Reset()">‚Ü∫ 70% / 30%</button>
        </div>
        <div class="gv-row" id="gv45"></div>
      </div>
      <div class="slider-box s32">
        <div class="stitle">ü´ì 32cm-es</div>
        <div class="slider-side">
          <label>Sima: <strong id="s32-sima">95%</strong> &nbsp; TK: <strong id="s32-tk">5%</strong></label>
          <input type="range" id="sl32" min="0" max="100" value="95" oninput="sl32Change(this.value)">
          <button class="reset-btn" onclick="sl32Reset()">‚Ü∫ 95% / 5%</button>
        </div>
        <div class="gv-row" id="gv32"></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">üçï Pizza t√≠pusonk√©nti bont√°s</div>
    <div class="etel-grid" id="pizza-grid"></div>
  </div>

  <div class="section">
    <div class="section-title">üì¶ Alapanyag sz√ºks√©glet</div>
    <table>
      <thead><tr><th>Alapanyag</th><th>Egys√©g</th><th>Sz√ºks√©ges</th><th>Alapegys√©g</th><th>Rendel√©shez</th></tr></thead>
      <tbody id="pizza-anyag-tabla"></tbody>
    </table>
  </div>

</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PASTA SZEKCI√ì ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="section-pasta" class="hidden">
<div class="container">

  <div class="mode-tabs">
    <div class="mode-tab active" id="ptab-pasta" onclick="setPastaMod('pasta')">üçù T√©szta<span class="sub">Fusili/Spagetti/Penne</span></div>
    <div class="mode-tab" id="ptab-gnocchi" onclick="setPastaMod('gnocchi')">ü•ü Gnocchi<span class="sub">K√ºl√∂n kezelve</span></div>
    <div class="mode-tab" id="ptab-kombi" onclick="setPastaMod('kombi')">üîÄ Kombin√°lt<span class="sub">Mindkett≈ë</span></div>
  </div>

  <div class="card">
    <h3 id="pasta-input-title">üìä Mennyi √°ru kell? (Pasta)</h3>
    <div class="input-panels" id="pasta-input-panels"></div>
  </div>

  <div class="summary-bar" id="pasta-summary"></div>

  <!-- T√©szta bont√°s -->
  <div class="teszta-box" id="teszta-box">
    <h4>üçù T√©szta bont√°s (Fusili / Spaghetti / Penne)</h4>
    <div style="font-size:12px;color:#888;margin-bottom:10px;">Az √∂sszes t√©szta √©telen bel√ºl melyik t√©szt√°val k√©rik ‚Äì alapb√≥l a val√≥s fogy√°si ar√°ny szerint.</div>
    <div class="teszta-sliders">
      <div class="teszta-slider">
        <label>Fusili: <strong id="teszta-fusili-pct">47%</strong></label>
        <input type="range" id="teszta-fusili-sl" min="0" max="100" value="47" oninput="tesztaSlChange()">
      </div>
      <div class="teszta-slider">
        <label>Spaghetti: <strong id="teszta-spagetti-pct">35%</strong></label>
        <input type="range" id="teszta-spagetti-sl" min="0" max="100" value="35" oninput="tesztaSlChange()">
      </div>
      <div class="teszta-slider">
        <label>Penne: <strong id="teszta-penne-pct">18%</strong></label>
        <input type="range" id="teszta-penne-sl" min="0" max="100" value="18" oninput="tesztaSlChange()">
      </div>
      <button class="reset-btn" onclick="tesztaReset()" style="align-self:flex-end;">‚Ü∫ Alap√©rtelmezett</button>
    </div>
    <div class="teszta-cards" id="teszta-cards"></div>
  </div>

  <div class="section">
    <div class="section-title pasta-color">üçù Pasta √©telek bont√°sa</div>
    <div class="etel-grid" id="pasta-grid"></div>
  </div>

  <div class="section">
    <div class="section-title pasta-color">üì¶ Pasta alapanyag sz√ºks√©glet</div>
    <table>
      <thead><tr>
        <th class="pasta-th">Alapanyag</th><th class="pasta-th">Egys√©g</th>
        <th class="pasta-th">Sz√ºks√©ges</th><th class="pasta-th">Alapegys√©g</th><th class="pasta-th">Rendel√©shez</th>
      </tr></thead>
      <tbody id="pasta-anyag-tabla"></tbody>
    </table>
  </div>

</div>
</div>

<!-- MODAL -->
<div class="modal-overlay hidden" id="settings-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>‚öôÔ∏è Be√°ll√≠t√°sok</h2>
      <button class="modal-close" onclick="closeSettings()">‚úï</button>
    </div>
    <div class="modal-tabs">
      <div class="modal-tab active" id="mtab-arak" onclick="setModalTab('arak')">üí∞ √Årak</div>
      <div class="modal-tab" id="mtab-pizzak" onclick="setModalTab('pizzak')">üçï Pizz√°k</div>
      <div class="modal-tab" id="mtab-pastak" onclick="setModalTab('pastak')">üçù Past√°k</div>
      <div class="modal-tab" id="mtab-profilok" onclick="setModalTab('profilok')">üë§ Profilok</div>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" onclick="resetAll()">‚Ü∫ Alap√©rtelmezett</button>
      <button class="btn btn-success btn-sm" onclick="closeSettings()">‚úì Ment√©s & bez√°r√°s</button>
    </div>
  </div>
</div>

<footer id="footer-bar">√âtterem Kalkul√°tor ¬∑ Pizza + Pasta alapanyag tervez≈ë</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KONFIGUR√ÅCI√ì
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEFAULTS = { szeletAr45: 1199, pizzaAr32: 5600, szeletPerGomboc: 8, pastaAr: 3090, gnocchiAr: 3390 };
let cfg = { ...DEFAULTS };

// ‚îÄ‚îÄ PIZZA ADATOK ‚îÄ‚îÄ
const defaultPizzaAlapanyagok = [
  { nev:"P sz√≥sz", egys:"g", alap:10000, ae:"g" },
  { nev:"Reszelt Mozzarella", egys:"g", alap:2500, ae:"g" },
  { nev:"P Sonka Cotto", egys:"g", alap:2000, ae:"g" },
  { nev:"Funghi mix zacsk√≥", egys:"db", alap:1, ae:"db" },
  { nev:"P Spinata Calabra", egys:"g", alap:1000, ae:"g" },
  { nev:"Gorgonzola", egys:"g", alap:500, ae:"g" },
  { nev:"Ricotta", egys:"g", alap:250, ae:"g" },
  { nev:"Parmez√°nsajt", egys:"g", alap:1000, ae:"g" },
  { nev:"Spen√≥t", egys:"db", alap:1, ae:"db" },
  { nev:"P Szal√°mi Napolitana", egys:"g", alap:500, ae:"g" },
  { nev:"Tartufata sz√≥sz", egys:"db", alap:1, ae:"db" },
  { nev:"P Z√∂lds√©g mix", egys:"g", alap:400, ae:"g" },
  { nev:"Nutella", egys:"g", alap:null, ae:null },
  { nev:"Kis Tonhalkonzerv", egys:"db", alap:1, ae:"db" },
  { nev:"Ol√≠vabogy√≥", egys:"g", alap:160, ae:"g" },
  { nev:"Pepperoni szal√°mi", egys:"g", alap:500, ae:"g" },
  { nev:"Szupercs√≠p≈ës pepperoni", egys:"g", alap:360, ae:"g" },
];

const defaultPizzak = [
  { nev:"Margherita", arany:18.02, aktiv:true,
    recept:[{a:"P sz√≥sz",m:240},{a:"Reszelt Mozzarella",m:230}] },
  { nev:"Prosciutto", arany:13.90, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Sonka Cotto",m:150}] },
  { nev:"SalaMe Dolce", arany:12.16, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Szal√°mi Napolitana",m:100}] },
  { nev:"Quattro", arany:8.17, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:150},{a:"Ricotta",m:100},{a:"Gorgonzola",m:80},{a:"Parmez√°nsajt",m:25}] },
  { nev:"Popeye", arany:6.52, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:180},{a:"Ricotta",m:50},{a:"Spen√≥t",m:150},{a:"Parmez√°nsajt",m:25}] },
  { nev:"Diavola", arany:6.38, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Spinata Calabra",m:80}] },
  { nev:"Prosciutto e Funghi", arany:5.13, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Sonka Cotto",m:120},{a:"Funghi mix zacsk√≥",m:100}] },
  { nev:"Tartufata", arany:4.75, aktiv:true,
    recept:[{a:"Funghi mix zacsk√≥",m:200},{a:"Reszelt Mozzarella",m:200},{a:"Tartufata sz√≥sz",m:160}] },
  { nev:"Salami & Zola", arany:4.34, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Spinata Calabra",m:80},{a:"Gorgonzola",m:70}] },
  { nev:"Pepperoni", arany:3.49, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"Pepperoni szal√°mi",m:100}] },
  { nev:"Alessandro Speciale", arany:2.84, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"P Sonka Cotto",m:80},{a:"Pepperoni szal√°mi",m:80},{a:"Gorgonzola",m:60}] },
  { nev:"Super Piccante", arany:1.42, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:180},{a:"Szupercs√≠p≈ës pepperoni",m:120}] },
  { nev:"Oliva", arany:0.89, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:180},{a:"Funghi mix zacsk√≥",m:100},{a:"Ol√≠vabogy√≥",m:80}] },
  { nev:"Rio Tonhalas", arany:0.53, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:180},{a:"Kis Tonhalkonzerv",m:1},{a:"Ol√≠vabogy√≥",m:50}] },
  { nev:"Funghi", arany:0.37, aktiv:true,
    recept:[{a:"P sz√≥sz",m:220},{a:"Reszelt Mozzarella",m:200},{a:"Funghi mix zacsk√≥",m:160}] },
  { nev:"Verdure", arany:0.35, aktiv:true,
    recept:[{a:"P sz√≥sz",m:240},{a:"P Z√∂lds√©g mix",m:400}] },
];

// ‚îÄ‚îÄ PASTA ADATOK ‚îÄ‚îÄ
// Ar√°nyok: t√©szta √©s gnocchi egy√ºttes lista normaliz√°lva 100%-ra
// T√©szta ar√°nyok √∂sszesen: Bolognese 27.03, Tartufata 13.30, N√©gysajtos 9.72, PannaProsciutto 7.61,
// Arrabiata 8.66, PestoGenova 5.21, Tonhalas 4.62, Vegetariana 1.18, Pomodoro 3.15, Bambino (nincs k√ºl√∂n, belesz√°m√≠tva)
// Gnocchi ar√°nyok: N√©gysajtos 5.29, BologneseG 3.48, PannaProsciuttoG 3.16, TartufataG 2.40,
// ArrabiataG 2.11, PestoGenovaG 1.85, PomodoroG 1.24, VegetarianaG 1.18

// Teljes √∂sszeg: 27.03+13.30+9.72+7.61+8.66+5.21+4.62+1.18+3.15 + 5.29+3.48+3.16+2.40+2.11+1.85+1.24+1.18 = ~101.19
// Normaliz√°lt 100%-ra

const defaultPastaEtelek = [
  // T√âSZTA √âTELEK
  { nev:"Bolognese", arany:27.03, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"P Bolognai ragu",m:400},{a:"Ol√≠vaolaj",m:10}] },
  { nev:"Tartufata", arany:13.30, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"Tartufata sz√≥sz pasta",m:100},{a:"Funghi mix zacsk√≥",m:50},{a:"Ol√≠vaolaj",m:10},{a:"Panna",m:50}] },
  { nev:"N√©gysajtos", arany:9.72, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"Gorgonzola",m:30},{a:"Ricotta",m:30},{a:"Parmez√°nsajt",m:20},{a:"Reszelt Mozzarella",m:30},{a:"Ol√≠vaolaj",m:10},{a:"Panna",m:70}] },
  { nev:"Arrabiata", arany:8.66, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"P sz√≥sz",m:200},{a:"Ol√≠vaolaj",m:10}] },
  { nev:"Panna Prosciutto", arany:7.61, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"Panna",m:140},{a:"Parmez√°nsajt",m:10},{a:"P Sonka Cotto",m:50}] },
  { nev:"Pesto Genova", arany:5.21, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"Pesto sz√≥sz",m:100}] },
  { nev:"Tonhalas", arany:4.62, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"Kis Tonhalkonzerv",m:1},{a:"P Ol√≠vabogy√≥",m:20},{a:"P sz√≥sz",m:150},{a:"Ol√≠vaolaj",m:20}] },
  { nev:"Pomodoro", arany:3.15, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"P sz√≥sz",m:200},{a:"Ol√≠vaolaj",m:10}] },
  { nev:"Vegetariana", arany:1.18, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"P Z√∂lds√©g mix",m:200},{a:"Ol√≠vaolaj",m:15}] },
  { nev:"Pasta Bambino", arany:0, aktiv:true, gnocchi:false,
    recept:[{a:"T√©szta",m:200},{a:"P sz√≥sz",m:200},{a:"Ol√≠vaolaj",m:10},{a:"Cukor",m:3}] },
  // GNOCCHI √âTELEK
  { nev:"N√©gysajtos Gnocchi", arany:5.29, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"Gorgonzola",m:15},{a:"Ricotta",m:15},{a:"Parmez√°nsajt",m:10},{a:"Reszelt Mozzarella",m:15},{a:"Ol√≠vaolaj",m:5},{a:"Panna",m:35}] },
  { nev:"Bolognese Gnocchi", arany:3.48, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"P Bolognai ragu",m:200},{a:"Ol√≠vaolaj",m:5}] },
  { nev:"Panna Prosciutto Gnocchi", arany:3.16, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"Panna",m:70},{a:"Parmez√°nsajt",m:5},{a:"P Sonka Cotto",m:25}] },
  { nev:"Tartufata Gnocchi", arany:2.40, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"Tartufata sz√≥sz pasta",m:50},{a:"Funghi mix zacsk√≥",m:25},{a:"Ol√≠vaolaj",m:5},{a:"Panna",m:25}] },
  { nev:"Arrabiata Gnocchi", arany:2.11, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"P sz√≥sz",m:100},{a:"Ol√≠vaolaj",m:5}] },
  { nev:"Pesto Genova Gnocchi", arany:1.85, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"Pesto sz√≥sz",m:50}] },
  { nev:"Pomodoro Gnocchi", arany:1.24, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"P sz√≥sz",m:100},{a:"Ol√≠vaolaj",m:5}] },
  { nev:"Vegetariana Gnocchi", arany:1.18, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"P Z√∂lds√©g mix",m:100},{a:"Ol√≠vaolaj",m:7.5}] },
  { nev:"Pasta Bambino Gnocchi", arany:0, aktiv:true, gnocchi:true,
    recept:[{a:"Gnocchi",m:250},{a:"P sz√≥sz",m:100},{a:"Ol√≠vaolaj",m:5},{a:"Cukor",m:1.5}] },
];

const defaultPastaAlapanyagok = [
  { nev:"T√©szta (Fusili)", egys:"g", alap:1000, ae:"g" },
  { nev:"T√©szta (Spaghetti)", egys:"g", alap:1000, ae:"g" },
  { nev:"T√©szta (Penne)", egys:"g", alap:1000, ae:"g" },
  { nev:"Gnocchi", egys:"g", alap:1000, ae:"g" },
  { nev:"P sz√≥sz", egys:"g", alap:10000, ae:"g" },
  { nev:"P Bolognai ragu", egys:"g", alap:2000, ae:"g" },
  { nev:"Tartufata sz√≥sz pasta", egys:"g", alap:1000, ae:"g" },
  { nev:"Pesto sz√≥sz", egys:"g", alap:1000, ae:"g" },
  { nev:"Panna", egys:"g", alap:1000, ae:"g" },
  { nev:"Ol√≠vaolaj", egys:"g", alap:1000, ae:"g" },
  { nev:"Funghi mix zacsk√≥", egys:"db", alap:1, ae:"db" },
  { nev:"Gorgonzola", egys:"g", alap:500, ae:"g" },
  { nev:"Ricotta", egys:"g", alap:250, ae:"g" },
  { nev:"Parmez√°nsajt", egys:"g", alap:1000, ae:"g" },
  { nev:"Reszelt Mozzarella", egys:"g", alap:2500, ae:"g" },
  { nev:"P Sonka Cotto", egys:"g", alap:2000, ae:"g" },
  { nev:"Kis Tonhalkonzerv", egys:"db", alap:1, ae:"db" },
  { nev:"P Ol√≠vabogy√≥", egys:"g", alap:160, ae:"g" },
  { nev:"P Z√∂lds√©g mix", egys:"g", alap:400, ae:"g" },
  { nev:"Cukor", egys:"g", alap:null, ae:null },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// √ÅLLAPOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function dc(o) { return JSON.parse(JSON.stringify(o)); }

let mainTab = 'pizza';
let pizzaMod = '45', pastaMod = 'pasta';
let modalTab = 'arak';
let simaArany45 = 70, simaArany32 = 95;
let db45 = 100, db32 = 0, dbPasta = 100, dbGnocchi = 0;
let tesztaFusili = 47, tesztaSpagetti = 35, tesztaPenne = 18;

// PROFIL RENDSZER
function ujProfilObj(nev, pizzak, pastak) {
  return { id: Date.now() + Math.random(), nev, pizzak: dc(pizzak), pastak: dc(pastak) };
}
const alapProfil = ujProfilObj('√Åltal√°nos', defaultPizzak, defaultPastaEtelek);
let profilok = [alapProfil];
let aktivProfilId = alapProfil.id;
function aktivProfil() { return profilok.find(p => p.id === aktivProfilId); }

let pizzak = aktivProfil().pizzak;
let pastak = aktivProfil().pastak;
let pizzaAlapanyagok = defaultPizzaAlapanyagok.map(a => ({...a}));
let pastaAlapanyagok = defaultPastaAlapanyagok.map(a => ({...a}));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// F≈ê F√úL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setMainTab(t) {
  mainTab = t;
  document.getElementById('maintab-pizza').classList.toggle('active', t==='pizza');
  document.getElementById('maintab-pasta').classList.toggle('active', t==='pasta');
  document.getElementById('section-pizza').classList.toggle('hidden', t!=='pizza');
  document.getElementById('section-pasta').classList.toggle('hidden', t!=='pasta');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PIZZA M√ìD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setMod(m) {
  pizzaMod = m;
  ['45','32','kombi'].forEach(t => document.getElementById('tab-'+t).classList.toggle('active', t===m));
  if(m==='45') db32=0;
  if(m==='32') db45=0;
  renderPizzaInputs(); pizzaFrissit();
}

function renderPizzaInputs() {
  let h = '';
  if(pizzaMod!=='32') h += pizzaPanel45();
  if(pizzaMod==='kombi') h += `<div style="display:flex;align-items:center;padding:0 6px;font-size:20px;color:#ccc;font-weight:bold;">+</div>`;
  if(pizzaMod!=='45') h += pizzaPanel32();
  document.getElementById('pizza-input-panels').innerHTML = h;
}

function pizzaPanel45() {
  return `<div class="input-panel p45"><h4>üçï 45cm-es ¬∑ ${fmt(cfg.szeletAr45)} Ft/szelet</h4>
    <div class="dual-input">
      <div class="iblock a45"><label>Darabsz√°m</label><div class="irow"><input type="number" id="i45db" value="${db45||''}" min="0" placeholder="db" oninput="iDb45()"><span class="sfx">db pizza</span></div></div>
      <div class="or-div">VAGY</div>
      <div class="iblock a45"><label>Forgalom</label><div class="irow"><input type="number" id="i45ft" value="${db45?db45*cfg.szeletPerGomboc*cfg.szeletAr45:''}" min="0" placeholder="Ft" oninput="iFt45()"><span class="sfx">Ft</span></div></div>
    </div></div>`;
}
function pizzaPanel32() {
  return `<div class="input-panel p32"><h4>ü´ì 32cm-es ¬∑ ${fmt(cfg.pizzaAr32)} Ft/pizza</h4>
    <div class="dual-input">
      <div class="iblock a32"><label>Darabsz√°m</label><div class="irow"><input type="number" id="i32db" value="${db32||''}" min="0" placeholder="db" oninput="iDb32()"><span class="sfx">db pizza</span></div></div>
      <div class="or-div">VAGY</div>
      <div class="iblock a32"><label>Forgalom</label><div class="irow"><input type="number" id="i32ft" value="${db32?db32*cfg.pizzaAr32:''}" min="0" placeholder="Ft" oninput="iFt32()"><span class="sfx">Ft</span></div></div>
    </div></div>`;
}

function iDb45() { db45=Math.ceil(parseFloat(document.getElementById('i45db').value)||0); const e=document.getElementById('i45ft'); if(e) e.value=db45>0?db45*cfg.szeletPerGomboc*cfg.szeletAr45:''; pizzaFrissit(); }
function iFt45() { const ft=parseFloat(document.getElementById('i45ft').value)||0; db45=Math.ceil(ft/cfg.szeletAr45/cfg.szeletPerGomboc); const e=document.getElementById('i45db'); if(e) e.value=db45>0?db45:''; pizzaFrissit(); }
function iDb32() { db32=Math.ceil(parseFloat(document.getElementById('i32db').value)||0); const e=document.getElementById('i32ft'); if(e) e.value=db32>0?db32*cfg.pizzaAr32:''; pizzaFrissit(); }
function iFt32() { const ft=parseFloat(document.getElementById('i32ft').value)||0; db32=Math.ceil(ft/cfg.pizzaAr32); const e=document.getElementById('i32db'); if(e) e.value=db32>0?db32:''; pizzaFrissit(); }

function sl45Change(v) { simaArany45=parseInt(v); document.getElementById('s45-sima').textContent=v+'%'; document.getElementById('s45-tk').textContent=(100-v)+'%'; pizzaFrissit(); }
function sl45Reset() { simaArany45=70; document.getElementById('sl45').value=70; sl45Change(70); }
function sl32Change(v) { simaArany32=parseInt(v); document.getElementById('s32-sima').textContent=v+'%'; document.getElementById('s32-tk').textContent=(100-v)+'%'; pizzaFrissit(); }
function sl32Reset() { simaArany32=95; document.getElementById('sl32').value=95; sl32Change(95); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASTA M√ìD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setPastaMod(m) {
  pastaMod = m;
  ['pasta','gnocchi','kombi'].forEach(t => document.getElementById('ptab-'+t).classList.toggle('active', t===m));
  if(m==='pasta') dbGnocchi=0;
  if(m==='gnocchi') dbPasta=0;
  const tb = document.getElementById('teszta-box');
  tb.classList.toggle('hidden', m==='gnocchi');
  renderPastaInputs(); pastaFrissit();
}

function renderPastaInputs() {
  let h = '';
  if(pastaMod!=='gnocchi') h += pastaPanel();
  if(pastaMod==='kombi') h += `<div style="display:flex;align-items:center;padding:0 6px;font-size:20px;color:#ccc;font-weight:bold;">+</div>`;
  if(pastaMod!=='pasta') h += gnocchiPanel();
  document.getElementById('pasta-input-panels').innerHTML = h;
}

function pastaPanel() {
  return `<div class="input-panel ppasta"><h4>üçù T√©szta ¬∑ ${fmt(cfg.pastaAr)} Ft √°tlag</h4>
    <div class="dual-input">
      <div class="iblock apasta"><label>Darabsz√°m</label><div class="irow"><input type="number" id="ipdb" value="${dbPasta||''}" min="0" placeholder="db" oninput="iPDb()"><span class="sfx">adag</span></div></div>
      <div class="or-div">VAGY</div>
      <div class="iblock apasta"><label>Forgalom</label><div class="irow"><input type="number" id="ipft" value="${dbPasta?dbPasta*cfg.pastaAr:''}" min="0" placeholder="Ft" oninput="iPFt()"><span class="sfx">Ft</span></div></div>
    </div></div>`;
}
function gnocchiPanel() {
  return `<div class="input-panel pgnocchi"><h4>ü•ü Gnocchi ¬∑ ${fmt(cfg.gnocchiAr)} Ft √°tlag</h4>
    <div class="dual-input">
      <div class="iblock agnocchi"><label>Darabsz√°m</label><div class="irow"><input type="number" id="igdb" value="${dbGnocchi||''}" min="0" placeholder="db" oninput="iGDb()"><span class="sfx">adag</span></div></div>
      <div class="or-div">VAGY</div>
      <div class="iblock agnocchi"><label>Forgalom</label><div class="irow"><input type="number" id="igft" value="${dbGnocchi?dbGnocchi*cfg.gnocchiAr:''}" min="0" placeholder="Ft" oninput="iGFt()"><span class="sfx">Ft</span></div></div>
    </div></div>`;
}

function iPDb() { dbPasta=Math.ceil(parseFloat(document.getElementById('ipdb').value)||0); const e=document.getElementById('ipft'); if(e) e.value=dbPasta>0?dbPasta*cfg.pastaAr:''; pastaFrissit(); }
function iPFt() { const ft=parseFloat(document.getElementById('ipft').value)||0; dbPasta=Math.ceil(ft/cfg.pastaAr); const e=document.getElementById('ipdb'); if(e) e.value=dbPasta>0?dbPasta:''; pastaFrissit(); }
function iGDb() { dbGnocchi=Math.ceil(parseFloat(document.getElementById('igdb').value)||0); const e=document.getElementById('igft'); if(e) e.value=dbGnocchi>0?dbGnocchi*cfg.gnocchiAr:''; pastaFrissit(); }
function iGFt() { const ft=parseFloat(document.getElementById('igft').value)||0; dbGnocchi=Math.ceil(ft/cfg.gnocchiAr); const e=document.getElementById('igdb'); if(e) e.value=dbGnocchi>0?dbGnocchi:''; pastaFrissit(); }

function tesztaSlChange() {
  tesztaFusili = parseInt(document.getElementById('teszta-fusili-sl').value);
  tesztaSpagetti = parseInt(document.getElementById('teszta-spagetti-sl').value);
  tesztaPenne = parseInt(document.getElementById('teszta-penne-sl').value);
  const ossz = tesztaFusili + tesztaSpagetti + tesztaPenne;
  document.getElementById('teszta-fusili-pct').textContent = ossz>0 ? Math.round(tesztaFusili/ossz*100)+'%' : '0%';
  document.getElementById('teszta-spagetti-pct').textContent = ossz>0 ? Math.round(tesztaSpagetti/ossz*100)+'%' : '0%';
  document.getElementById('teszta-penne-pct').textContent = ossz>0 ? Math.round(tesztaPenne/ossz*100)+'%' : '0%';
  pastaFrissit();
}
function tesztaReset() {
  tesztaFusili=47; tesztaSpagetti=35; tesztaPenne=18;
  document.getElementById('teszta-fusili-sl').value=47;
  document.getElementById('teszta-spagetti-sl').value=35;
  document.getElementById('teszta-penne-sl').value=18;
  tesztaSlChange();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEG√âDF√úGGV√âNYEK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ceiling(v,a) { return Math.ceil(v/a)*a; }
function fmt(n) { return Number(n).toLocaleString('hu-HU'); }
function fmtFt(n) { return Number(n).toLocaleString('hu-HU')+' Ft'; }
function aktivPizzak() { return pizzak.filter(p=>p.aktiv); }
function aktivTesztak() { return pastak.filter(p=>p.aktiv && !p.gnocchi); }
function aktivGnocchik() { return pastak.filter(p=>p.aktiv && p.gnocchi); }
function pizzaOsszeArany() { return Math.round(aktivPizzak().reduce((s,p)=>s+p.arany,0)*100)/100; }
function pastaOsszeArany() { return Math.round([...aktivTesztak(),...aktivGnocchik()].reduce((s,p)=>s+p.arany,0)*100)/100; }

const pizzaCsomagSuly = { "Funghi mix zacsk√≥":1800, "Spen√≥t":1800, "Tartufata sz√≥sz":1200 };
const pastaCsomagSuly = { "Funghi mix zacsk√≥":1800, "Kis Tonhalkonzerv":1 };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PIZZA FRISS√çT√âS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pizzaFrissit() {
  const tk45=100-simaArany45, tk32=100-simaArany32;
  const ft45=db45*cfg.szeletPerGomboc*cfg.szeletAr45, ft32=db32*cfg.pizzaAr32;

  // Summary
  let sh='';
  if(pizzaMod!=='32') sh+=`<div class="si"><div class="sl">45cm pizza</div><div class="sv">${fmt(db45)} db</div></div>
    <div class="si"><div class="sl">Szelet</div><div class="sv">${fmt(db45*cfg.szeletPerGomboc)} db</div></div>
    <div class="si hl"><div class="sl">45cm forgalom</div><div class="sv">${fmtFt(ft45)}</div></div>`;
  if(pizzaMod==='kombi') sh+=`<div class="ssep"></div>`;
  if(pizzaMod!=='45') sh+=`<div class="si"><div class="sl">32cm pizza</div><div class="sv">${fmt(db32)} db</div></div>
    <div class="si hl"><div class="sl">32cm forgalom</div><div class="sv">${fmtFt(ft32)}</div></div>`;
  if(pizzaMod==='kombi') sh+=`<div class="ssep"></div><div class="si hl"><div class="sl">üèÜ √ñsszes</div><div class="sv">${fmtFt(ft45+ft32)}</div></div>`;
  document.getElementById('pizza-summary').innerHTML=sh;
  document.getElementById('pizza-input-title').textContent=`üìä Mennyi √°ru kell? ¬∑ Profil: ${aktivProfil().nev}`;

  // Gomb√≥c k√°rty√°k
  if(pizzaMod!=='32') document.getElementById('gv45').innerHTML=
    `<div class="gv"><div class="gl">Sima</div><div class="gn">${Math.round(db45*simaArany45/100)}</div><div class="gp">${simaArany45}%</div></div>
    <div class="vs">vs</div><div class="gv tk"><div class="gl">TK</div><div class="gn">${Math.round(db45*tk45/100)}</div><div class="gp">${tk45}%</div></div>`;
  if(pizzaMod!=='45') document.getElementById('gv32').innerHTML=
    `<div class="gv" style="border-color:#E8A000;background:#fff8e1"><div class="gl">Sima</div><div class="gn" style="color:#7A4F00">${Math.round(db32*simaArany32/100)}</div><div class="gp" style="color:#E8A000">${simaArany32}%</div></div>
    <div class="vs">vs</div><div class="gv tk"><div class="gl">TK</div><div class="gn">${Math.round(db32*tk32/100)}</div><div class="gp">${tk32}%</div></div>`;

  // Pizza grid
  document.getElementById('pizza-grid').innerHTML = aktivPizzak().map(pz => {
    const d45=Math.round(db45*pz.arany/100), d32=Math.round(db32*pz.arany/100);
    let dbh='';
    if(pizzaMod==='45') dbh=`<div class="etel-db">${d45} db</div>`;
    else if(pizzaMod==='32') dbh=`<div class="etel-db" style="color:#E8A000">${d32} db</div>`;
    else dbh=`<div class="etel-db">${d45} db</div><div class="etel-db" style="color:#E8A000;font-size:11px">${d32} 32cm</div>`;
    return `<div class="etel-card"><div><div class="etel-nev">${pz.nev}</div><div class="etel-pct">${pz.arany}%</div></div><div>${dbh}</div></div>`;
  }).join('');

  // Alapanyag √∂sszes√≠t≈ë
  const ossz = {};
  aktivPizzak().forEach(pz => {
    const d45p=db45*pz.arany/100, d32p=db32*pz.arany/100;
    pz.recept.forEach(r => {
      if(!ossz[r.a]) ossz[r.a]=0;
      ossz[r.a] += d45p*r.m + d32p*r.m*0.5;
    });
  });

  let html=`<tr class="gh gh-gomboc"><td colspan="5">ü´ì Gomb√≥c</td></tr>`;
  const gsorok=[
    {nev:`Sima gomb√≥c 45cm (${simaArany45}%)`,egys:"db",ertek:Math.round(db45*simaArany45/100),alap:6,ae:"db",cls:"row-gomboc"},
    {nev:`TK gomb√≥c 45cm (${tk45}%)`,egys:"db",ertek:Math.round(db45*tk45/100),alap:6,ae:"db",cls:"row-gomboc"},
  ];
  if(pizzaMod!=='45') {
    gsorok.push({nev:`Sima gomb√≥c 32cm (${simaArany32}%)`,egys:"db",ertek:Math.round(db32*simaArany32/100),alap:12,ae:"db",cls:"row-gomboc"});
    gsorok.push({nev:`TK gomb√≥c 32cm (${tk32}%)`,egys:"db",ertek:Math.round(db32*tk32/100),alap:8,ae:"db",cls:"row-gomboc"});
  }
  gsorok.forEach(r => {
    html+=`<tr class="${r.cls}"><td>${r.nev}</td><td>${r.egys}</td><td><span class="val">${fmt(r.ertek)}</span></td><td>${fmt(r.alap)} ${r.ae}</td><td><span class="ceil">${fmt(ceiling(r.ertek,r.alap))} ${r.ae}</span></td></tr>`;
  });

  html+=`<tr class="gh gh-alap"><td colspan="5">üì¶ Alapanyagok</td></tr>`;
  const feldolg=new Set();
  pizzaAlapanyagok.forEach(a => {
    if(ossz[a.nev]===undefined) return;
    feldolg.add(a.nev);
    let ertek=ossz[a.nev];
    if(a.egys==="db" && pizzaCsomagSuly[a.nev]) ertek=ertek/pizzaCsomagSuly[a.nev];
    ertek=Math.round(ertek*100)/100;
    const cs=a.alap!==null?`<span class="ceil">${fmt(ceiling(ertek,a.alap))} ${a.ae}</span>`:'<span class="dash">‚Äì</span>';
    const as=a.alap!==null?`${fmt(a.alap)} ${a.ae}`:'<span class="dash">‚Äì</span>';
    html+=`<tr class="row-norm"><td>${a.nev}</td><td>${a.egys}</td><td><span class="val">${fmt(ertek)}</span><span class="unit"> ${a.egys}</span></td><td>${as}</td><td>${cs}</td></tr>`;
  });
  Object.keys(ossz).forEach(nev => {
    if(feldolg.has(nev)) return;
    html+=`<tr class="row-norm"><td>${nev}</td><td>g</td><td><span class="val">${fmt(Math.round(ossz[nev]))}</span></td><td><span class="dash">‚Äì</span></td><td><span class="dash">‚Äì</span></td></tr>`;
  });

  document.getElementById('pizza-anyag-tabla').innerHTML=html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASTA FRISS√çT√âS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pastaFrissit() {
  const ftPasta=dbPasta*cfg.pastaAr, ftGnocchi=dbGnocchi*cfg.gnocchiAr;
  const ossz_t=tesztaFusili+tesztaSpagetti+tesztaPenne||1;
  const pctF=tesztaFusili/ossz_t, pctS=tesztaSpagetti/ossz_t, pctP=tesztaPenne/ossz_t;

  // Summary
  let sh='';
  if(pastaMod!=='gnocchi') sh+=`<div class="si"><div class="sl">T√©szta adag</div><div class="sv">${fmt(dbPasta)} db</div></div>
    <div class="si hl"><div class="sl">T√©szta forgalom</div><div class="sv">${fmtFt(ftPasta)}</div></div>`;
  if(pastaMod==='kombi') sh+=`<div class="ssep"></div>`;
  if(pastaMod!=='pasta') sh+=`<div class="si"><div class="sl">Gnocchi adag</div><div class="sv">${fmt(dbGnocchi)} db</div></div>
    <div class="si hl"><div class="sl">Gnocchi forgalom</div><div class="sv">${fmtFt(ftGnocchi)}</div></div>`;
  if(pastaMod==='kombi') sh+=`<div class="ssep"></div><div class="si hl"><div class="sl">üèÜ √ñsszes</div><div class="sv">${fmtFt(ftPasta+ftGnocchi)}</div></div>`;
  document.getElementById('pasta-summary').innerHTML=sh;
  document.getElementById('pasta-input-title').textContent=`üìä Mennyi √°ru kell? ¬∑ Profil: ${aktivProfil().nev}`;

  // T√©szta k√°rty√°k
  document.getElementById('teszta-cards').innerHTML=`
    <div class="teszta-card"><div class="tn">Fusili</div><div class="tv">${Math.round(dbPasta*pctF)} db</div><div class="tp">${Math.round(pctF*100)}%</div></div>
    <div class="teszta-card"><div class="tn">Spaghetti</div><div class="tv">${Math.round(dbPasta*pctS)} db</div><div class="tp">${Math.round(pctS*100)}%</div></div>
    <div class="teszta-card"><div class="tn">Penne</div><div class="tv">${Math.round(dbPasta*pctP)} db</div><div class="tp">${Math.round(pctP*100)}%</div></div>`;

  // √âtel bont√°s
  const tesztak=aktivTesztak(), gnocchik=aktivGnocchik();
  const tOssz=tesztak.reduce((s,p)=>s+p.arany,0)||1;
  const gOssz=gnocchik.reduce((s,p)=>s+p.arany,0)||1;

  let gridH='';
  if(pastaMod!=='gnocchi') tesztak.forEach(p => {
    const db=Math.round(dbPasta*p.arany/tOssz);
    gridH+=`<div class="etel-card pasta-card"><div><div class="etel-nev">${p.nev}</div><div class="etel-pct">${p.arany}%</div></div><div class="etel-db pasta-db">${db} db</div></div>`;
  });
  if(pastaMod!=='pasta') gnocchik.forEach(p => {
    const db=Math.round(dbGnocchi*p.arany/gOssz);
    gridH+=`<div class="etel-card gnocchi-card"><div><div class="etel-nev">${p.nev}</div><div class="etel-pct">${p.arany}%</div></div><div class="etel-db gnocchi-db">${db} db</div></div>`;
  });
  document.getElementById('pasta-grid').innerHTML=gridH;

  // Alapanyag √∂sszes√≠t≈ë
  const pOssz={};
  if(pastaMod!=='gnocchi') tesztak.forEach(p => {
    const db=dbPasta*p.arany/tOssz;
    p.recept.forEach(r => {
      if(!pOssz[r.a]) pOssz[r.a]=0;
      if(r.a==='T√©szta') {
        // T√©szta 3 fel√© bontva
        if(!pOssz['T√©szta (Fusili)']) pOssz['T√©szta (Fusili)']=0;
        if(!pOssz['T√©szta (Spaghetti)']) pOssz['T√©szta (Spaghetti)']=0;
        if(!pOssz['T√©szta (Penne)']) pOssz['T√©szta (Penne)']=0;
        pOssz['T√©szta (Fusili)'] += db*r.m*pctF;
        pOssz['T√©szta (Spaghetti)'] += db*r.m*pctS;
        pOssz['T√©szta (Penne)'] += db*r.m*pctP;
      } else {
        pOssz[r.a] += db*r.m;
      }
    });
  });
  if(pastaMod!=='pasta') gnocchik.forEach(p => {
    const db=dbGnocchi*p.arany/gOssz;
    p.recept.forEach(r => {
      if(!pOssz[r.a]) pOssz[r.a]=0;
      pOssz[r.a] += db*r.m;
    });
  });

  let phtml='';
  const pfeldolg=new Set();
  pastaAlapanyagok.forEach(a => {
    if(pOssz[a.nev]===undefined) return;
    pfeldolg.add(a.nev);
    let ertek=pOssz[a.nev];
    if(a.egys==="db" && a.nev==="Kis Tonhalkonzerv") ertek=Math.round(ertek);
    else ertek=Math.round(ertek);
    const cs=a.alap!==null?`<span class="ceil">${fmt(ceiling(ertek,a.alap))} ${a.ae}</span>`:'<span class="dash">‚Äì</span>';
    const as=a.alap!==null?`${fmt(a.alap)} ${a.ae}`:'<span class="dash">‚Äì</span>';
    // T√©szta sorok lila, gnocchi sorok z√∂ld
    const isTeszta=a.nev.includes('T√©szta');
    const isGnocchi=a.nev==='Gnocchi';
    const cls=isTeszta?'row-pasta':isGnocchi?'row-gnocchi':'row-norm';
    phtml+=`<tr class="${cls}"><td>${a.nev}</td><td>${a.egys}</td><td><span class="val">${fmt(ertek)}</span><span class="unit"> ${a.egys}</span></td><td>${as}</td><td>${cs}</td></tr>`;
  });
  Object.keys(pOssz).forEach(nev => {
    if(pfeldolg.has(nev)) return;
    phtml+=`<tr class="row-norm"><td>${nev}</td><td>g</td><td><span class="val">${fmt(Math.round(pOssz[nev]))}</span></td><td><span class="dash">‚Äì</span></td><td><span class="dash">‚Äì</span></td></tr>`;
  });
  document.getElementById('pasta-anyag-tabla').innerHTML=phtml;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfilBar() {
  let h='<span class="profil-label">Profil:</span>';
  profilok.forEach(p => {
    h+=`<button class="profil-btn ${p.id===aktivProfilId?'active':''}" onclick="profilValtas(${p.id})">${p.nev}</button>`;
  });
  h+=`<button class="profil-btn uj" onclick="openSettings();setModalTab('profilok')">+ √öj profil</button>`;
  document.getElementById('profil-bar').innerHTML=h;
}

function profilValtas(id) {
  aktivProfilId=id;
  pizzak=aktivProfil().pizzak;
  pastak=aktivProfil().pastak;
  renderProfilBar(); renderModalBody(); pizzaFrissit(); pastaFrissit();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openSettings() { document.getElementById('settings-modal').classList.remove('hidden'); renderModalBody(); }
function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); renderPizzaInputs(); renderPastaInputs(); pizzaFrissit(); pastaFrissit(); }

function setModalTab(t) {
  modalTab=t;
  ['arak','pizzak','pastak','profilok'].forEach(tab => {
    const el=document.getElementById('mtab-'+tab);
    if(el) el.classList.toggle('active', tab===t);
  });
  renderModalBody();
}

function renderModalBody() {
  if(modalTab==='arak') renderArakTab();
  else if(modalTab==='pizzak') renderEtelek(pizzak, 'pizza');
  else if(modalTab==='pastak') renderEtelek(pastak, 'pasta');
  else renderProfilokTab();
}

function renderArakTab() {
  document.getElementById('modal-body').innerHTML=`
    <div class="settings-grid">
      <div class="si-item"><label>üçï 45cm szelet √°ra (Ft)</label>
        <input type="number" id="set-szelet-ar" value="${cfg.szeletAr45}" min="1" oninput="cfgV()">
        <span class="hint">1 szelet √°ra</span></div>
      <div class="si-item"><label>ü´ì 32cm pizza √°ra (Ft)</label>
        <input type="number" id="set-pizza-ar32" value="${cfg.pizzaAr32}" min="1" oninput="cfgV()">
        <span class="hint">1 eg√©sz pizza √°ra</span></div>
      <div class="si-item"><label>‚úÇÔ∏è Szelet / gomb√≥c</label>
        <input type="number" id="set-spg" value="${cfg.szeletPerGomboc}" min="1" max="20" oninput="cfgV()">
        <span class="hint">H√°ny szelet a 45cm-es</span></div>
      <div class="si-item"><label>üçù T√©szta √°tlag√°r (Ft)</label>
        <input type="number" id="set-pasta-ar" value="${cfg.pastaAr}" min="1" oninput="cfgV()">
        <span class="hint">Forint alap√∫ kalkul√°ci√≥hoz</span></div>
      <div class="si-item"><label>ü•ü Gnocchi √°tlag√°r (Ft)</label>
        <input type="number" id="set-gnocchi-ar" value="${cfg.gnocchiAr}" min="1" oninput="cfgV()">
        <span class="hint">Forint alap√∫ kalkul√°ci√≥hoz</span></div>
      <div class="si-item" style="background:#f7f9fc;border-radius:8px;padding:14px;">
        <label>üìä √ñsszefoglal√≥</label>
        <div style="font-size:13px;color:#555;margin-top:6px;line-height:2;">
          1 gomb√≥c (45cm) = <strong>${fmtFt(cfg.szeletPerGomboc*cfg.szeletAr45)}</strong><br>
          1 pizza (32cm) = <strong>${fmtFt(cfg.pizzaAr32)}</strong><br>
          T√©szta √°tlag = <strong>${fmtFt(cfg.pastaAr)}</strong><br>
          Gnocchi √°tlag = <strong>${fmtFt(cfg.gnocchiAr)}</strong>
        </div></div>
    </div>`;
}

function cfgV() {
  cfg.szeletAr45=parseInt(document.getElementById('set-szelet-ar').value)||cfg.szeletAr45;
  cfg.pizzaAr32=parseInt(document.getElementById('set-pizza-ar32').value)||cfg.pizzaAr32;
  cfg.szeletPerGomboc=parseInt(document.getElementById('set-spg').value)||cfg.szeletPerGomboc;
  cfg.pastaAr=parseInt(document.getElementById('set-pasta-ar').value)||cfg.pastaAr;
  cfg.gnocchiAr=parseInt(document.getElementById('set-gnocchi-ar').value)||cfg.gnocchiAr;
  renderArakTab();
}

function renderEtelek(lista, tipus) {
  const ossz = Math.round(lista.filter(p=>p.aktiv).reduce((s,p)=>s+p.arany,0)*100)/100;
  const okE = Math.abs(ossz-100)<0.1;
  const normFn = tipus==='pizza'?'normPizza':'normPasta';
  let h=`<div class="etel-settings-header">
    <div>
      <div style="font-size:12px;color:#888;margin-bottom:4px;">Kapcsold ki amit nem k√≠n√°lsz ¬∑ √Åll√≠tsd be az ar√°nyokat</div>
      <div class="arany-ossz ${okE?'ok':'err'}">√ñsszes ar√°ny: ${ossz}% ${okE?'‚úì':'‚ö† Normaliz√°lj!'}</div>
    </div>
    <button class="norm-btn" onclick="${normFn}()">‚öñÔ∏è Normaliz√°l√°s</button>
  </div>`;

  lista.forEach((p,i) => {
    const isG = p.gnocchi;
    h+=`<div class="etel-row">
      <label class="toggle-wrap"><input type="checkbox" ${p.aktiv?'checked':''} onchange="toggleEtel('${tipus}',${i})"><span class="tog-sl"></span></label>
      <span class="etel-nev-lbl ${p.aktiv?'':'off'}">${p.nev}${isG?' <span style="font-size:10px;background:#27ae60;color:white;border-radius:4px;padding:1px 5px;">ü•ü</span>':''}</span>
      <div class="arany-iw">
        <input class="arany-inp" type="number" value="${p.arany}" min="0" max="100" step="0.01" ${p.aktiv?'':'disabled'} oninput="aranyV('${tipus}',${i},this.value)">
        <span style="font-size:12px;color:#888;">%</span>
      </div>
    </div>`;
  });
  document.getElementById('modal-body').innerHTML=h;
}

function toggleEtel(tipus, i) {
  const lista = tipus==='pizza'?pizzak:pastak;
  lista[i].aktiv=!lista[i].aktiv;
  aktivProfil()[tipus==='pizza'?'pizzak':'pastak']=lista;
  renderEtelek(lista, tipus);
  if(tipus==='pizza') pizzaFrissit(); else pastaFrissit();
}

function aranyV(tipus, i, val) {
  const lista = tipus==='pizza'?pizzak:pastak;
  lista[i].arany=Math.round(parseFloat(val)*100)/100||0;
  aktivProfil()[tipus==='pizza'?'pizzak':'pastak']=lista;
  const ossz=Math.round(lista.filter(p=>p.aktiv).reduce((s,p)=>s+p.arany,0)*100)/100;
  const okE=Math.abs(ossz-100)<0.1;
  const el=document.querySelector('.arany-ossz');
  if(el){el.textContent=`√ñsszes ar√°ny: ${ossz}% ${okE?'‚úì':'‚ö† Normaliz√°lj!'}`; el.className=`arany-ossz ${okE?'ok':'err'}`;}
  if(tipus==='pizza') pizzaFrissit(); else pastaFrissit();
}

function normPizza() {
  const ak=pizzak.filter(p=>p.aktiv); const ossz=ak.reduce((s,p)=>s+p.arany,0);
  if(!ossz) return;
  ak.forEach(p=>p.arany=Math.round(p.arany/ossz*10000)/100);
  const diff=Math.round((100-ak.reduce((s,p)=>s+p.arany,0))*100)/100;
  if(diff&&ak.length) ak[0].arany=Math.round((ak[0].arany+diff)*100)/100;
  aktivProfil().pizzak=pizzak; renderEtelek(pizzak,'pizza'); pizzaFrissit();
}
function normPasta() {
  const ak=pastak.filter(p=>p.aktiv); const ossz=ak.reduce((s,p)=>s+p.arany,0);
  if(!ossz) return;
  ak.forEach(p=>p.arany=Math.round(p.arany/ossz*10000)/100);
  const diff=Math.round((100-ak.reduce((s,p)=>s+p.arany,0))*100)/100;
  if(diff&&ak.length) ak[0].arany=Math.round((ak[0].arany+diff)*100)/100;
  aktivProfil().pastak=pastak; renderEtelek(pastak,'pasta'); pastaFrissit();
}

function renderProfilokTab() {
  let h=`<div class="profil-lista">`;
  profilok.forEach((p,i) => {
    const isA=p.id===aktivProfilId;
    h+=`<div class="profil-sor ${isA?'aktiv':''}">
      <input class="profil-nev-inp" type="text" value="${p.nev}" oninput="profilNev(${p.id},this.value)">
      ${isA?'<span class="profil-aktiv-badge">‚úì Akt√≠v</span>':`<button class="btn btn-primary btn-xs" onclick="profilValtas(${p.id});renderProfilokTab()">Aktiv√°l√°s</button>`}
      ${i===0?'<span class="profil-default-badge">Alap</span>':`<button class="btn btn-danger btn-xs" onclick="profilTorol(${p.id})">üóë</button>`}
    </div>`;
  });
  h+=`</div>
  <div class="uj-profil-form">
    <h4>‚ûï √öj profil l√©trehoz√°sa</h4>
    <div class="form-row">
      <div class="form-field"><label>Profil neve</label><input type="text" id="uj-profil-nev" placeholder="pl. Rendezv√©ny"></div>
      <div class="form-field"><label>M√°sol√°s innen</label>
        <select id="uj-profil-forras">${profilok.map(p=>`<option value="${p.id}">${p.nev}</option>`).join('')}</select>
      </div>
    </div>
    <div style="font-size:12px;color:#888;margin-bottom:10px;">A kiv√°lasztott profil pizz√°it √©s past√°it m√°solja ‚Äì ut√°na szabadon szerkesztheted.</div>
    <button class="btn btn-success btn-sm" onclick="ujProfilMent()">‚úì L√©trehoz√°s</button>
    <span id="uj-profil-hiba" style="color:#c0392b;font-size:12px;margin-left:10px;"></span>
  </div>`;
  document.getElementById('modal-body').innerHTML=h;
}

function profilNev(id, nev) { const p=profilok.find(x=>x.id===id); if(p){p.nev=nev; renderProfilBar();} }
function profilTorol(id) {
  const p=profilok.find(x=>x.id===id);
  if(!confirm(`T√∂rl√∂d: "${p.nev}"?`)) return;
  if(id===aktivProfilId) { aktivProfilId=profilok[0].id; pizzak=aktivProfil().pizzak; pastak=aktivProfil().pastak; }
  profilok=profilok.filter(x=>x.id!==id);
  renderProfilBar(); renderProfilokTab(); pizzaFrissit(); pastaFrissit();
}
function ujProfilMent() {
  const nev=document.getElementById('uj-profil-nev').value.trim();
  const hiba=document.getElementById('uj-profil-hiba');
  if(!nev){hiba.textContent='Add meg a nevet!';return;}
  if(profilok.find(p=>p.nev.toLowerCase()===nev.toLowerCase())){hiba.textContent='M√°r van ilyen nev≈± profil!';return;}
  const forrasId=parseFloat(document.getElementById('uj-profil-forras').value);
  const forras=profilok.find(p=>p.id===forrasId)||profilok[0];
  const uj=ujProfilObj(nev, forras.pizzak, forras.pastak);
  profilok.push(uj);
  hiba.textContent='';
  profilValtas(uj.id);
  renderProfilokTab();
}

function resetAll() {
  if(!confirm('Vissza√°ll√≠tod az √∂sszes be√°ll√≠t√°st?')) return;
  cfg={...DEFAULTS};
  const alap=ujProfilObj('√Åltal√°nos', defaultPizzak, defaultPastaEtelek);
  profilok=[alap]; aktivProfilId=alap.id;
  pizzak=aktivProfil().pizzak; pastak=aktivProfil().pastak;
  pizzaAlapanyagok=defaultPizzaAlapanyagok.map(a=>({...a}));
  pastaAlapanyagok=defaultPastaAlapanyagok.map(a=>({...a}));
  renderProfilBar(); renderModalBody(); pizzaFrissit(); pastaFrissit();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
renderProfilBar();
renderPizzaInputs();
renderPastaInputs();
db45=100; dbPasta=100;
pizzaFrissit();
pastaFrissit();
</script>
</body>
</html>
